<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Video App (Working Demo)</title>
    
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet" />
    
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>

    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f4f4f4; }
        .header { background-color: #333; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .page { padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 1200px; margin: 20px auto; }
        button, .download-button button { padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; margin-right: 10px; }
        input[type="text"], input[type="password"] { padding: 10px; margin: 5px 0 15px 0; display: inline-block; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; width: 100%; }
        
        /* Home Page Layout */
        .video-container-wrapper { display: flex; flex-wrap: wrap; gap: 20px; }
        .main-video-content { flex: 3; min-width: 400px; }
        .sidebar { flex: 1; background-color: #f9f9f9; padding: 15px; border-radius: 4px; max-width: 300px; }
        .sidebar-item { padding: 10px; margin-bottom: 5px; cursor: pointer; background-color: #eee; border-radius: 4px; transition: background-color 0.3s; }
        .sidebar-item:hover { background-color: #ddd; }
        .sidebar-item.active { background-color: #007bff; color: white; font-weight: bold; }
        
        /* Comments Style */
        .comment-item { border-bottom: 1px solid #eee; padding: 8px 0; }
        .timestamp { color: #888; font-size: 0.8em; margin-left: 10px; }
        .comment-input-box { display: flex; gap: 10px; margin-bottom: 15px; }
        .comment-input-box input { flex-grow: 1; margin: 0; }
    </style>
</head>

<body>

    <header class="header" id="main-header" style="display: none;">
        <div>
            <span style="font-size: 1.2em;">Video Stream</span> 
            <span id="username-display" style="margin-left: 15px;"></span>
        </div>
        <div>
            <button onclick="showPage('home-page')">ğŸ  Home</button>
            <button onclick="showPage('profile-page')">ğŸ‘¤ Profile</button>
            <button onclick="handleLogout()">ğŸšª Exit</button>
        </div>
    </header>

    <div id="loading-page" class="page" style="display: block; text-align: center;">
        <h1>â³ App á€€á€­á€¯ á€…á€á€„á€ºá€”á€±á€•á€«á€á€Šá€º...</h1>
    </div>

    <div id="login-page" class="page" style="display: none;">
        <h2>á€á€„á€ºá€›á€”á€º</h2>
        <input type="text" id="login-username" placeholder="á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€¡á€™á€Šá€º á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
        <input type="password" id="login-password" placeholder="á€œá€»á€¾á€­á€¯á€·á€á€¾á€€á€ºá€”á€¶á€•á€«á€á€º">
        <button onclick="handleLogin()">Login</button>
        <button onclick="showPage('register-page')">á€¡á€€á€±á€¬á€„á€·á€º á€™á€›á€¾á€­á€á€±á€¸á€˜á€°á€¸</button>
        <p id="login-message" style="color: red;"></p>
    </div>

    <div id="register-page" class="page" style="display: none;">
        <h2>á€™á€¾á€á€ºá€•á€¯á€¶á€á€„á€ºá€›á€”á€º</h2>
        <p>á€™á€¾á€á€ºá€á€»á€€á€ºá‹ á‹ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€¡á€™á€Šá€ºá€”á€±á€›á€¬á€á€½á€„á€º á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</p>
        <input type="text" id="register-username" placeholder="á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€¡á€™á€Šá€º/á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
        <input type="password" id="register-password" placeholder="á€œá€»á€¾á€­á€¯á€·á€á€¾á€€á€ºá€”á€¶á€•á€«á€á€º (á€¡á€”á€Šá€ºá€¸á€†á€¯á€¶á€¸ á† á€œá€¯á€¶á€¸)">
        <button onclick="handleRegister()">Register</button>
        <button onclick="showPage('login-page')">á€•á€¼á€”á€ºá€á€½á€¬á€¸á€›á€”á€º</button>
        <p id="register-message" style="color: red;"></p>
    </div>

    <div id="home-page" class="page" style="display: none;">
        <h2>á€—á€®á€’á€®á€šá€­á€¯á€™á€»á€¬á€¸</h2>

        <div class="video-container-wrapper"> 
            
            <div class="main-video-content">
                
                <div class="video-player-box">
                    <video id="my-video" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="auto" data-setup='{}'></video>
                </div>

                <div class="video-info-actions">
                    <h3 id="current-video-title-text">á€—á€®á€’á€®á€šá€­á€¯ á€á€±á€«á€„á€ºá€¸á€…á€‰á€º</h3>
                    
                    <button id="like-button" onclick="window.toggleLike()" style="background-color: #28a745; color: white;">
                        ğŸ‘ á€œá€­á€¯á€€á€ºá€á€º (<span id="like-count">0</span>) 
                    </button>
                    
                    <a id="download-link" href="#" download class="download-button" target="_blank">
                        <button style="background-color: #007bff; color: white;">â¬‡ï¸ Download</button>
                    </a>
                    
                </div>
                
                <hr>
                
                <div class="comments-section">
                    <h4>á€™á€¾á€á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸ (<span id="comment-count">0</span>)</h4>
                    
                    <div class="comment-input-box">
                        <input type="text" id="comment-input" placeholder="á€™á€¾á€á€ºá€á€»á€€á€ºá€•á€±á€¸á€›á€”á€º á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«...">
                        <button onclick="window.addComment()" style="background-color: #ffc107;">Send</button>
                    </div>
                    
                    <div id="comments-list" class="comments-list">
                        </div>
                </div>

            </div> <div id="video-sidebar" class="sidebar">
                <h4>á€—á€®á€’á€®á€šá€­á€¯ á€…á€¬á€›á€„á€ºá€¸</h4>
                </div>

        </div> </div> <div id="profile-page" class="page" style="display: none;">
        <h2>ğŸ‘¤ Profile</h2>
        <p><strong>á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€¡á€™á€Šá€º:</strong> <span id="profile-username">N/A</span></p>
        <p><strong>á€™á€¾á€á€ºá€•á€¯á€¶á€á€„á€ºá€á€Šá€·á€ºá€”á€±á€·:</strong> <span id="profile-registered-date">N/A</span></p>
        <p><strong>á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€á€„á€ºá€›á€±á€¬á€€á€ºá€á€Šá€·á€ºá€”á€±á€·:</strong> <span id="profile-last-login">N/A</span></p>

        <h3>á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸</h3>
        <label for="profile-phone">á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º (Display Name á€¡á€–á€¼á€…á€º á€á€¯á€¶á€¸á€á€Šá€º)</label>
        <input type="text" id="profile-phone" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
        
        <button onclick="updateProfileDetails()" style="background-color: #17a2b8; color: white;">Update Profile</button>
        <p id="profile-message" style="color: green; margin-top: 10px;"></p>
        <button onclick="showPage('home-page')">Home á€á€­á€¯á€· á€•á€¼á€”á€ºá€á€½á€¬á€¸á€›á€”á€º</button>
    </div>

    <script src="https://vjs.zencdn.net/8.6.1/video.js"></script>
    
    <script>
        // á€á€„á€·á€ºá€›á€²á€· JavaScript Code á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€¤á€”á€±á€›á€¬á€á€½á€„á€º á€€á€°á€¸á€‘á€Šá€·á€ºá€•á€«
        // ... (á€á€„á€ºá€•á€±á€¸á€•á€­á€¯á€·á€‘á€¬á€¸á€á€±á€¬ JavaScript Code á€¡á€¬á€¸á€œá€¯á€¶á€¸) ...
        
        // =================================================
        // ğŸš¨ Part 1: Firebase Configuration & Setup
        // =================================================

        // ğŸ’¡ á€á€„á€·á€ºá€›á€²á€· á€•á€±á€¸á€‘á€¬á€¸á€á€±á€¬ Firebase Config ID á€™á€»á€¬á€¸
        const firebaseConfig = {
            apiKey: "AIzaSyBHFEAoD5nMUg7azmeeAFdy4Btlff5qiXQ",
            authDomain: "my-webi-dc06d.firebaseapp.com",
            projectId: "my-webi-dc06d",
            storageBucket: "my-webi-dc06d.firebasestorage.app", 
            messagingSenderId: "939042419939",
            appId: "1:939042419939:web:49e96f18117a68bb8b01d6",
            measurementId: "G-DJ9046C036"
        };

        window.app = firebase.initializeApp(firebaseConfig);
        window.auth = firebase.auth();

        // =================================================
        // ğŸš¨ Part 2: Page Navigation & UI Functions
        // =================================================

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            const targetPage = document.getElementById(pageId);
            if (targetPage) targetPage.style.display = 'block';

            // Header á€€á€­á€¯ Login/Register Pages á€á€½á€„á€º á€á€¾á€€á€ºá€‘á€¬á€¸á€á€¼á€„á€ºá€¸
            const header = document.getElementById('main-header');
            if (pageId === 'login-page' || pageId === 'register-page' || pageId === 'loading-page') {
                header.style.display = 'none';
            } else {
                header.style.display = 'flex';
            }
            
            if (pageId === 'home-page') {
                initializeVideoPlayer(); 
            } else if (pageId === 'profile-page') {
                loadProfileData(); 
            }
        }
        window.showPage = showPage;

        function loadProfileData() {
            const user = window.auth.currentUser;
            if (user) {
                document.getElementById('profile-phone').value = user.displayName || ''; 
                document.getElementById('profile-message').textContent = '';
            }
        }


        // =================================================
        // ğŸš¨ Part 3: Authentication (Login/Register/Logout)
        // =================================================

        // Register Function
        window.handleRegister = async () => {
            const emailInput = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value.trim();
            const messageDiv = document.getElementById('register-message');
            const email = emailInput.includes('@') ? emailInput : `${emailInput}@dummy.com`; 

            if (password.length < 6) { messageDiv.textContent = 'á€œá€»á€¾á€­á€¯á€·á€á€¾á€€á€ºá€”á€¶á€•á€«á€á€ºá€á€Šá€º á† á€œá€¯á€¶á€¸á€‘á€€á€º á€™á€”á€Šá€ºá€¸á€›á€•á€«á‹'; return; }
            messageDiv.textContent = 'á€™á€¾á€á€ºá€•á€¯á€¶á€á€„á€ºá€”á€±á€•á€«á€á€Šá€ºá‹ á€€á€»á€±á€¸á€‡á€°á€¸á€•á€¼á€¯á á€…á€±á€¬á€„á€·á€ºá€†á€­á€¯á€„á€ºá€¸á€•á€«á‹';

            try {
                await window.auth.createUserWithEmailAndPassword(email, password);
                await window.auth.signInWithEmailAndPassword(email, password); 
                
                await window.auth.currentUser.updateProfile({
                    displayName: emailInput 
                });

                messageDiv.textContent = 'á€™á€¾á€á€ºá€•á€¯á€¶á€á€„á€º á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€ºá‹ á€á€á€…á€±á€¬á€„á€·á€ºá€•á€«á‹'; 
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') { messageDiv.textContent = 'á€¤á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€¡á€™á€Šá€ºá€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸á€á€¬á€¸ á€–á€¼á€…á€ºá€•á€«á€á€Šá€ºá‹'; } 
                else { messageDiv.textContent = `Error: ${error.message}`; }
            }
        };

        // Login Function (Fix: á€á€»á€€á€ºá€á€»á€„á€ºá€¸ Home Page á€€á€­á€¯ á€•á€¼á€±á€¬á€„á€ºá€¸á€á€Šá€º)
        window.handleLogin = async () => {
            const emailInput = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const messageDiv = document.getElementById('login-message');
            const email = emailInput.includes('@') ? emailInput : `${emailInput}@dummy.com`; 

            messageDiv.textContent = 'á€á€„á€ºá€›á€±á€¬á€€á€ºá€”á€±á€•á€«á€á€Šá€ºá‹'; 

            try {
                await window.auth.signInWithEmailAndPassword(email, password);
                
                messageDiv.textContent = 'Login á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€ºá‹'; 
                // showPage('home-page'); // onAuthStateChanged á€€ á€€á€­á€¯á€„á€ºá€á€½á€šá€ºá€•á€«á€™á€Šá€º

            } catch (error) {
                messageDiv.textContent = 'á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€¡á€™á€Šá€º á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€œá€»á€¾á€­á€¯á€·á€á€¾á€€á€ºá€”á€¶á€•á€«á€á€º á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€ºá‹';
            }
        };

        // Logout Function
        window.handleLogout = async () => {
            try {
                await window.auth.signOut();
            } catch (error) {
                console.error("Logout Error:", error);
            }
        };

        // Auth State Check (Loading Page á€•á€¼á€¿á€”á€¬ á€–á€¼á€±á€›á€¾á€„á€ºá€¸á€‘á€¬á€¸á€á€Šá€º)
        window.auth.onAuthStateChanged((user) => {
            // ğŸš¨ Loading Page á€€á€­á€¯ á€•á€­á€á€ºá€•á€¼á€®á€¸ á€á€€á€ºá€†á€­á€¯á€„á€ºá€›á€¬ Page á€€á€­á€¯ á€•á€¼á€á€á€Šá€º
            document.getElementById('loading-page').style.display = 'none';
            
            if (user) {
                const displayUsername = user.email.includes('@dummy.com') ? user.email.replace('@dummy.com', '') : user.email.split('@')[0];

                document.getElementById('username-display').textContent = displayUsername; 
                document.getElementById('profile-username').textContent = displayUsername; 
                
                const creationDate = user.metadata.creationTime ? new Date(user.metadata.creationTime).toLocaleString() : 'N/A';
                const lastLogin = user.metadata.lastSignInTime ? new Date(user.metadata.lastSignInTime).toLocaleString() : 'N/A';
                document.getElementById('profile-registered-date').textContent = creationDate;
                document.getElementById('profile-last-login').textContent = lastLogin;
                
                showPage('home-page'); 

            } else {
                showPage('login-page');
            }
        });


        // =================================================
        // ğŸš¨ Part 4: Profile Update Logic (Photo Upload á€–á€¼á€¯á€á€ºá€‘á€¬á€¸á€á€Šá€º)
        // =================================================

        // Profile á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸ (á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º) á€€á€­á€¯ Update á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
        window.updateProfileDetails = async () => {
            const user = window.auth.currentUser;
            const phone = document.getElementById('profile-phone').value.trim();
            const messageDiv = document.getElementById('profile-message');

            if (!user) { messageDiv.textContent = 'User not logged in.'; return; }
            
            try {
                await user.updateProfile({
                    displayName: phone 
                });
                messageDiv.textContent = 'á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€…á€½á€¬ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹';
                loadProfileData(); 
            } catch (error) {
                messageDiv.textContent = `Update Failed: ${error.message}`;
            }
        }


        // =================================================
        // ğŸš¨ Part 5: Video Player & Data Persistence Logic (Like/Comment)
        // =================================================

        // ğŸ“„ app.js (Part 5: Video Player & Data Persistence Logic)

        let videos = [
            { 
                id: 1, 
                url: 'https://download2285.mediafire.com/e6w0xns4olkgqf58wWvPLniykI0hY48zWD3PFlqPl_ZJ0419p96tay2TFwvGobbKaHrw5gAPL2Eh-yYb7tuAO6vio6nPlTemPrg3OtHeHeUY-6goBDQrJFKIpmYs5irC92fefYCLbbRvu3ROYq9Qe2oEmrMDtyhSn1BPmy43NM0/ep6gqdvvjkpdaos/5_6208271644641729117.mp4', 
                title: 'Second Testing Stream',
                download: 'https://download2285.mediafire.com/e6w0xns4olkgqf58wWvPLniykI0hY48zWD3PFlqPl_ZJ0419p96tay2TFwvGobbKaHrw5gAPL2Eh-yYb7tuAO6vio6nPlTemPrg3OtHeHeUY-6goBDQrJFKIpmYs5irC92fefYCLbbRvu3ROYq9Qe2oEmrMDtyhSn1BPmy43NM0/ep6gqdvvjkpdaos/5_6208271644641729117.mp4', 
                currentLikes: 8, 
                userLiked: false, 
                currentComments: []
            },
            { 
                id: 2, 
                url: 'https://video.example.com/thai-schoolgirl-2.mp4', 
                title: 'Thai Schoolgirl showing off her fake tits (Dropbox)', 
                download: 'https://video.example.com/thai-schoolgirl-2.mp4',
                currentLikes: 15, 
                userLiked: false, 
                currentComments: []
            }
        ];

        let currentVideoIndex = 0; 
        let player; 

        function loadDataFromStorage() {
            const storedData = localStorage.getItem('videoData');
            
            // ğŸ’¡ á€šá€¬á€šá€® á€›á€¾á€„á€ºá€¸á€œá€„á€ºá€¸á€›á€±á€¸ Logic (2 á€á€¯ á€‘á€€á€ºá€”á€Šá€ºá€¸á€›á€„á€º á€›á€¾á€„á€ºá€¸á€‘á€¯á€á€ºá€•á€«)
            if (storedData) {
                let tempVideos = JSON.parse(storedData);
                
                if (tempVideos.length < videos.length) { // 2 á€á€¯á€‘á€€á€º á€”á€Šá€ºá€¸á€›á€„á€º
                    console.log("Local Storage data á€á€Šá€º Code á€¡á€á€…á€ºá€”á€¾á€„á€ºá€· á€™á€€á€­á€¯á€€á€ºá€Šá€®á€•á€«áŠ á€›á€¾á€„á€ºá€¸á€œá€„á€ºá€¸á€•á€«á€™á€Šá€ºá‹");
                    localStorage.removeItem('videoData');
                    videos.forEach((v, i) => v.id = i + 1);
                    saveDataToStorage();
                    return; 
                }
                
                videos = tempVideos;

            } else {
                videos.forEach((v, i) => v.id = i + 1);
                saveDataToStorage(); 
            }
        }

        function saveDataToStorage() {
            localStorage.setItem('videoData', JSON.stringify(videos));
        }

        function initializeVideoPlayer() {
            loadDataFromStorage();

            if (!player) {
                // ğŸš¨ Video Player á€€á€­á€¯ initialize á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
                player = videojs('my-video'); 
            }
            if (currentVideoIndex >= videos.length) currentVideoIndex = 0;

            renderSidebar();
            loadVideo(videos[currentVideoIndex], currentVideoIndex); 
        }

        function loadVideo(video, index) {
            currentVideoIndex = index;
            // Video Player Source á€¡á€…á€¬á€¸á€‘á€­á€¯á€¸á€á€¼á€„á€ºá€¸
            player.src({ src: video.url, type: 'video/mp4' });
            player.load();
            
            document.getElementById('current-video-title-text').textContent = video.title;
            document.getElementById('download-link').href = video.download;
            updateLikeStatus(video);
            renderComments(video); 
            updateSidebarHighlight();
        }

        // Like Functions
        function updateLikeStatus(video) {
            const likeButton = document.getElementById('like-button');
            if (!likeButton) return;

            if (video.userLiked) {
                likeButton.innerHTML = `â¤ï¸ á€œá€­á€¯á€€á€ºá€á€º (${video.currentLikes})`;
            } else {
                likeButton.innerHTML = `ğŸ‘ á€œá€­á€¯á€€á€ºá€á€º (${video.currentLikes})`;
            }
        }

        window.toggleLike = () => {
            const video = videos[currentVideoIndex];
            if (video.userLiked) {
                video.currentLikes--;
            } else {
                video.currentLikes++;
            }
            video.userLiked = !video.userLiked;
            
            saveDataToStorage(); 

            updateLikeStatus(video);
        }

        // Comment Functions
        window.addComment = () => {
            const commentInput = document.getElementById('comment-input');
            const commentText = commentInput.value.trim();
            const user = window.auth.currentUser;
            const username = user ? (user.email.includes('@dummy.com') ? user.email.replace('@dummy.com', '') : user.email.split('@')[0]) : 'Guest'; 
            
            if (commentText) {
                const video = videos[currentVideoIndex];
                const newComment = {
                    user: username,
                    text: commentText,
                    timestamp: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false }),
                    id: Date.now()
                };
                video.currentComments.push(newComment);
                
                saveDataToStorage();

                commentInput.value = '';
                renderComments(video);
            }
        }

        window.deleteComment = (videoId, commentId) => {
            const video = videos.find(v => v.id === videoId);
            if (video) {
                video.currentComments = video.currentComments.filter(c => c.id !== commentId);
                
                saveDataToStorage();
                renderComments(video);
            }
        }

        function renderComments(video) {
            const commentsList = document.getElementById('comments-list');
            if (!commentsList) return;
            
            commentsList.innerHTML = '';
            document.getElementById('comment-count').textContent = video.currentComments.length;
            
            const currentUser = window.auth.currentUser;
            const currentUsername = currentUser ? (currentUser.email.includes('@dummy.com') ? currentUser.email.replace('@dummy.com', '') : currentUser.email.split('@')[0]) : 'Guest';

            video.currentComm
